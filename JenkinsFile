pipeline {
    agent none
    stages {

         stage('init') {
                  agent { docker {
                    image 'golang'
                    args '-u root:sudo -v $HOME'
                     }
                    }
                   when{
                     branch 'development'
                   }
                   steps {
                                          sh 'go version'
                                          sh 'go clean -cache'
                                          sh 'go build ./cmd/activity_manager_bootstrap.go'
                                          sh 'go test ./...'
                         }

               }

        stage('build') {
           agent { label 'slave2' }
            steps {
                                   script {



                                           def customImage = docker.build('singaravelan21/todo_list_manager', "./")
                                           docker.withRegistry('https://registry.hub.docker.com', 'dockerhub') {
                                           customImage.push("${env.BUILD_NUMBER}")
                                           def externalMethod = evaluate readTrusted("file.groovy")
                                           def loadedfunc = load("file.groovy")
                                           loadedfunc.dockerVersion(customImage)
                                           sh 'docker system prune'
                                            }
                                           }
                            }

        }


            }
    }

